<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.0af2dcaf883aa2418c4e.css">@import url(https://fonts.googleapis.com/css?family=Noto+Serif+JP:400,700,900&display=swap);@import url(https://fonts.googleapis.com/css?family=Noto+Sans+JP:100,400&subset=japanese);.post-link-container{margin:1em 0}.post-link-container a{text-decoration:none}.post-link-title-txt{display:inline-block;margin:.2em 0;font-family:"Noto Serif JP",serif;font-size:2.2em;font-weight:400;color:#000}.post-link-date-txt,.post-link-tag-txt{display:inline-block;margin:0 .2em;color:#555;font-family:Noto Sans JP,sans-serif;font-weight:400;font-size:1.1em}.post-link-date-txt{margin-left:0}.post-link-tag-txt{font-weight:100}.post-link-tag-txt:hover{text-decoration:underline}.post-link-tag-container{display:inline-block}.app-container header{margin:2.5em 0 1em;font-size:1.05em}header a{text-decoration:none;color:#000}.header-title-txt{font-family:"Noto Serif JP",serif;font-weight:900;font-size:3em;margin:0 0 .4em}.category-filter-txt{display:inline-block;border-left:1px solid #000;padding:0 .5em;font-size:1.2em;font-family:Courier New,Courier,Noto Sans JP,monospace;font-weight:100;color:#666}.category-filter-txt.category-selected{color:#000;text-decoration:underline}.category-filter-txt.category-hided{display:none}.header-category-filter-container a:first-child h3{border-left:none;padding-left:0}.post-date-txt,.post-tag-txt{display:inline-block;font-size:1em}.post-tag-txt:hover{text-decoration:underline}.post-tags-container{display:inline-block}.post-content-container header{margin:2.5em 0}@media (max-width:768px){body,html{font-size:12px}}.post-content-container{margin:0 auto;padding:0 2rem 1.45rem;max-width:900px;font-size:1.2em;font-family:"Noto Serif JP",serif}.post-title-txt{margin-bottom:.2em;font-family:"Noto Serif JP",serif;font-weight:400;font-size:2.8em}.post-date-txt,.post-tag-txt{margin:0 .4em;color:#555;font-size:.95em;font-family:Noto Sans JP,sans-serif}.post-date-txt{margin-left:0;font-weight:700}.post-tag-txt{font-weight:100}.post-wrapper{font-size:1.05em;line-height:1.7em}.post-wrapper blockquote{color:#555;font-style:italic}.post-wrapper hr{margin:0 auto 1.45rem;max-width:30%;background-color:#888}.post-wrapper h1,.post-wrapper h2,.post-wrapper h3,.post-wrapper h4,.post-wrapper h5,.post-wrapper h6{font-family:"Noto Serif JP",serif}.post-wrapper a{color:#0d69da;text-decoration:none}.post-wrapper a:hover{text-decoration:underline}.post-wrapper li{margin:0}.post-wrapper code{padding:.2em;color:#333;border-radius:.2em}.post-wrapper code,.post-wrapper pre{background-color:#ddd}.post-wrapper .youtube{margin:auto auto 1.45rem;width:810px;height:455.625px}.post-wrapper .youtube iframe{margin:auto;width:100%;height:100%;border:none}footer{margin-top:4em;font-family:Courier New,Courier,monospace}.footer--link_title{font-family:"Noto Serif JP",sans-serif;font-weight:700;font-size:1.5em;color:#000;text-decoration:none}.footer--link_container:last-of-type{margin:1em 0 0}.footer--link{margin:0;padding:0 .5em;border:solid #000;border-width:0 0 0 1px;text-decoration:none;color:#000;font-size:1em}.footer--link:first-of-type{padding-left:0;margin-left:0;border-left:none}.footer--link:hover{text-decoration:underline}html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#eee;font-family:"Noto Serif JP",serif;font-size:15.5px}.app-container{margin:0 auto;max-width:900px;padding:0 2rem 1.45rem}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.45em georgia,serif;box-sizing:border-box;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{color:#000;font-family:georgia,serif;font-weight:400;word-wrap:break-word;-webkit-font-kerning:normal;font-kerning:normal;-ms-font-feature-settings:"kern","liga","clig","calt";font-feature-settings:"kern","liga","clig","calt"}img{max-width:100%;padding:0;margin:0 0 1.45rem}h1{font-size:2.25rem}h1,h2{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h2{font-size:1.62671rem}h3{font-size:1.38316rem}h3,h4{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h4{font-size:1rem}h5{font-size:.85028rem}h5,h6{padding:0;margin:0 0 1.45rem;color:inherit;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-weight:700;text-rendering:optimizeLegibility;line-height:1.1}h6{font-size:.78405rem}hgroup{padding:0;margin:0 0 1.45rem}ol,ul{padding:0;margin:0 0 1.45rem 1.45rem;list-style-position:outside;list-style-image:none}dd,dl,figure,p{padding:0;margin:0 0 1.45rem}pre{margin:0 0 1.45rem;font-size:.85rem;line-height:1.42;background:rgba(0,0,0,.04);border-radius:3px;overflow:auto;word-wrap:normal;padding:1.45rem}table{font-size:1rem;line-height:1.45rem;border-collapse:collapse;width:100%}fieldset,table{padding:0;margin:0 0 1.45rem}blockquote{padding:0;margin:0 1.45rem 1.45rem}form,iframe,noscript{padding:0;margin:0 0 1.45rem}hr{padding:0;margin:0 0 calc(1.45rem - 1px);background:rgba(0,0,0,.2);border:none;height:1px}address{padding:0;margin:0 0 1.45rem}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-left:1.45rem;margin-bottom:.725rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{border-bottom:1px solid rgba(0,0,0,.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}pre code{background:none;line-height:1.42}@media only screen and (max-width:480px){html{font-size:100%}}@media (max-width:1260px){body,html{font-size:14px}.app-container{max-width:768px}.post-wrapper .youtube{margin:auto auto 1.45rem;width:675px;height:379.6875px}}@media (max-width:768px){body,html{font-size:13px}.app-container,.post-content-container{max-width:calc(768px - 4rem)}.post-wrapper{font-size:1.2em}.post-wrapper .youtube{margin:auto auto 1.45rem;width:calc(90vw - 3.6rem);height:calc((81vw - 3.24rem)/1.6)}}@media (max-width:420px){body,html{font-size:11.5px}.header-title-txt{font-size:2.5em}.post-date-txt,.post-tag-txt{font-size:1.2em}.post-wrapper{font-size:1.3em}}</style><meta name="generator" content="Gatsby 2.19.18"/><title data-react-helmet="true">Unity dev memo (2) | The work is undone.</title><meta data-react-helmet="true" name="description" content="asukachikaru&#x27;s blog."/><meta data-react-helmet="true" property="og:title" content="Unity dev memo (2) | The work is undone."/><meta data-react-helmet="true" property="og:description" content="asukachikaru&#x27;s blog."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:url" content="https://blog.asukachikaru.com/post/unity-dev-memo-(2)"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="asukachikaru"/><meta data-react-helmet="true" name="twitter:title" content="Unity dev memo (2) | The work is undone."/><meta data-react-helmet="true" name="twitter:description" content="asukachikaru&#x27;s blog."/><link rel="icon" href="/icons/icon-48x48.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=d9107bb5832c4c0bf399c3c74632c7b2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notosansjp/v27/-F62fjtqLzI2JPCgQBnw7HFYwQgP.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notosansjp/v27/-F6ofjtqLzI2JPCgQBnw7HFQojgN8lI.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notosansjp/v27/-F6pfjtqLzI2JPCgQBnw7HFQei0a1Xdg.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notoserifjp/v7/xn77YHs72GKoTvER4Gn3b5eMZFqJdkkVUg.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notoserifjp/v7/xn77YHs72GKoTvER4Gn3b5eMZGKLdkkVUg.woff2"/><link rel="preload" as="font" type="font/woff2" crossorigin="anonymous" href="/google-fonts/s/notoserifjp/v7/xn7mYHs72GKoTvER4Gn3b5eMbNmuYw.woff2"/><style type="text/css">@font-face{font-family:'Noto Sans JP';font-style:normal;font-weight:100;src:local('Noto Sans Japanese Thin'),local('NotoSansJapanese-Thin'),url(/google-fonts/s/notosansjp/v27/-F6ofjtqLzI2JPCgQBnw7HFQojgN8lI.woff2) format('woff2'),url(/google-fonts/s/notosansjp/v27/-F6ofjtqLzI2JPCgQBnw7HFQojgN8lQ.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Sans JP';font-style:normal;font-weight:400;src:local('Noto Sans Japanese Regular'),local('NotoSansJapanese-Regular'),url(/google-fonts/s/notosansjp/v27/-F62fjtqLzI2JPCgQBnw7HFYwQgP.woff2) format('woff2'),url(/google-fonts/s/notosansjp/v27/-F62fjtqLzI2JPCgQBnw7HFYwQgJ.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Sans JP';font-style:normal;font-weight:700;src:local('Noto Sans Japanese Bold'),local('NotoSansJapanese-Bold'),url(/google-fonts/s/notosansjp/v27/-F6pfjtqLzI2JPCgQBnw7HFQei0a1Xdg.woff2) format('woff2'),url(/google-fonts/s/notosansjp/v27/-F6pfjtqLzI2JPCgQBnw7HFQei0a1Xdm.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Serif JP';font-style:normal;font-weight:400;src:local('Noto Serif JP'),local('NotoSerifJP-Regular'),url(/google-fonts/s/notoserifjp/v7/xn7mYHs72GKoTvER4Gn3b5eMbNmuYw.woff2) format('woff2'),url(/google-fonts/s/notoserifjp/v7/xn7mYHs72GKoTvER4Gn3b5eMbNmuZQ.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Serif JP';font-style:normal;font-weight:700;src:local('Noto Serif JP Bold'),local('NotoSerifJP-Bold'),url(/google-fonts/s/notoserifjp/v7/xn77YHs72GKoTvER4Gn3b5eMZGKLdkkVUg.woff2) format('woff2'),url(/google-fonts/s/notoserifjp/v7/xn77YHs72GKoTvER4Gn3b5eMZGKLdkkVVA.woff) format('woff');font-display: swap;}@font-face{font-family:'Noto Serif JP';font-style:normal;font-weight:900;src:local('Noto Serif JP Black'),local('NotoSerifJP-Black'),url(/google-fonts/s/notoserifjp/v7/xn77YHs72GKoTvER4Gn3b5eMZFqJdkkVUg.woff2) format('woff2'),url(/google-fonts/s/notoserifjp/v7/xn77YHs72GKoTvER4Gn3b5eMZFqJdkkVVA.woff) format('woff');font-display: swap;}</style><link as="script" rel="preload" href="/webpack-runtime-93de27eba6033d0c0cfc.js"/><link as="script" rel="preload" href="/app-255b885323bf9f0bff99.js"/><link as="script" rel="preload" href="/styles-55de889ca647a3996baf.js"/><link as="script" rel="preload" href="/commons-680b037267ae7ccea9ab.js"/><link as="script" rel="preload" href="/component---src-templates-post-content-view-js-da53bbbc7baa758e9b08.js"/><link as="fetch" rel="preload" href="/page-data/post/unity-dev-memo-(2)/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="post-content-container"><header><h1 class="post-title-txt">Unity dev memo (2)</h1><h3 class="post-date-txt">2020-10-04</h3><div class="post-tags-container"><a href="/tag/unity"><h3 class="post-tag-txt">#Unity</h3></a><a href="/tag/game-design"><h3 class="post-tag-txt">#Game Design</h3></a></div></header><main><div class="post-wrapper"><h2>Raycast</h2>
<p>在使用滑鼠的 3D 遊戲中，幾乎與任何物件互動都需要使用滑鼠，判斷玩家游標的位置自然是非常重要且基礎的技術。然而相對 3D 世界的三維座標，存在於螢幕上的游標只有二維座標的 X 軸與 Y 軸兩個數據代表位置，這使得在遊戲世界中精準定位游標位置變得困難。</p>
<p>不過，大多數想要在遊戲中取得游標位置時，都是為了與存在該位置的物件互動。這個物件就能成為定位游標的輔助工具，只要計算從玩家視角中的游標，是否真正與遊戲世界中的該物件重合即可。</p>
<p>具體來說，這個判斷方式是從攝影機朝向滑鼠的二維座標射出一道直線，並判斷該射線所相交的物件。</p>
<h3>Plane.Raycast</h3>
<p>先從這個技術的最基本實作，也就是判斷滑鼠在純平面上的座標開始。</p>
<pre><code class="language-csharp">using UnityEngine;

public class GetMousePos : MonoBehaviour {
    Plane plane = new Plane (Vector3.up, 0);
    Camera camera;
    Vector3 mousePos;

    void Start () {
        camera = Camera.main;
    }

    void Update () {
        float distance;
        Ray ray = camera.ScreenPointToRay(Input.mousePosition);
        if(plane.Raycast(ray, out distance)){
            mousePos = ray.GetPoint(distance);
        }
    }
}
</code></pre>
<p>一行一行解讀：</p>
<pre><code class="language-csharp">Plane plane = new Plane (Vector3.up, 0);
</code></pre>
<p>從<a target="_blank" rel="noopener noreferrer" href="https://docs.unity3d.com/ScriptReference/Plane-ctor.html">官方文件</a> 可以查到 Plane 的 constructor 是長這樣： <code>Plane (Vector3 inNormal, float distance)</code> 。</p>
<p>以三維座標 (0, 0, 0) 為基準點，基於法線方向 <code>inNormal</code> 在距離基準點 <code>distance</code> 的位置創造一個平面。 <code>Vector3.up</code> 就等於 <code>Vector3 (0, 1, 0)</code> ，也就是筆直朝向 Y 軸上方的向量。這個 plane 不會顯示在遊戲中，如果想要用視覺理解 plane 的概念，可以直接在 Editor 中新增一個 rotation 與 position 都為 (0, 0, 0) 的 Plane，這兩個平面基本上相同。</p>
<pre><code class="language-csharp">   Camera camera;
   Vector3 mousePos;
   void Start () {
       camera = Camera.main;
   }
</code></pre>
<p>將目前使用的主攝影機存為變數，並預先設立儲存滑鼠位置用的變數。</p>
<pre><code class="language-csharp">void Update () {
    float distance;
    Ray ray = camera.ScreenPointToRay(Input.mousePosition);
    ...
</code></pre>
<p>在每次更新時，創建一個空的距離變數 <code>distance</code> ，以及一個射線變數 <code>ray</code> ，起點為攝影機的 near clipping plane，方向為滑鼠位置。</p>
<p>攝影機的顯示範圍是一個上窄下寬的梯形，頂部距離攝影機較近且面積較小的平面就是 near clipping plane，底部較遠較大的平面就是 far clipping plane。玩家所謂的遊戲視窗大小基本上就等於 near clipping plane， <code>Camera.ScreenPointToRay</code> 也就是從 near clipping plane 射向 far clipping plane。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 800px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/9ddf073bcf08fcfa2b3e4cefca28375d/fe4e9/unity_dev_memo_2_1.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 89.27536231884058%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACbElEQVQ4y32Ta1PaQBiF8/f6oa1jayW3vW+y2TBgvDDAtCrqtMO1Ikpti9SAKDBOp/2HfZMIRWbamTPJZnef8569xNCSpmJasHxAiztY87RHkHXJrEGXiPF3jJPQw2GANEdaYCXJqqBnXRwbi1bKMDfypRYqpDhyc/uJTHjuIhOGAo7WZCQvGFhoX7g7yKpubRxtb5a3Ng5fvqhsvqq+fa2x7bNnM0EAg6WrUycfWQXzzYH0LmqH/X672Tg7PalWy1GxoPIeUtTyiRVwJ1EGa4CZI5HpYasc+ef14/vBxa9p73HS+znpzcf9h9uru+HloN+5Oq8fVfZ8AvOxZnbAbEMRW1G7squuu8ePk+59fD0fn89GHdA0boFmo9Ysbs/H3YfbTpTXAjGfCkmFR4WxG/Kv3RqU+j29uBv2xjefZ3Hr4TZT+/5HKxN4vd/X0t3WPKmpmCuINELhliPVODn4fvkxHkDaz9MYmOZk2EifzbubxnzUqdcOhJPTzAloJltibkALFiydnEC8VBDN02jYr03j+nycWIwHDfC66hz62ARgIdg5JDED2NbM8illrgcm1nZAXF0MS43TyvDL2WzUjr99KngY4GSTljDGEhMj+/YIw04e2UXb3HPhvN6FxIJrY38o5UsFD1zhRNRKZY9wRR1jGQY+fIIhD4yFHJZnwqlyJycX5KoE5sFzOBHAAjOOuCQkKcWe+ld4KAtzKNQwVsmnedSCFJJQsBCY+BQwa4UHOFkwNIy1PM8tbKjPEYMsycWiVhrEgsypo/1PeGmRbieCiwXyKAYeMqsF7Pyfz6ImfwV1AaOuSnfLBPAPjpLILuFRiLoAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="unity dev memo 2 1"
        title="unity dev memo 2 1"
        src="/static/9ddf073bcf08fcfa2b3e4cefca28375d/7842b/unity_dev_memo_2_1.png"
        srcset="/static/9ddf073bcf08fcfa2b3e4cefca28375d/f8f3a/unity_dev_memo_2_1.png 200w,
/static/9ddf073bcf08fcfa2b3e4cefca28375d/6a8a8/unity_dev_memo_2_1.png 400w,
/static/9ddf073bcf08fcfa2b3e4cefca28375d/7842b/unity_dev_memo_2_1.png 800w,
/static/9ddf073bcf08fcfa2b3e4cefca28375d/5ece7/unity_dev_memo_2_1.png 1200w,
/static/9ddf073bcf08fcfa2b3e4cefca28375d/fe4e9/unity_dev_memo_2_1.png 1380w"
        sizes="(max-width: 800px) 100vw, 800px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>這兩個數值都可以從 camera 的 inspector 調整。</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 474px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2f836733ac31ec72684262016169db69/a9480/unity_dev_memo_2_2.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 267.72151898734177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="unity dev memo 2 2"
        title="unity dev memo 2 2"
        src="/static/2f836733ac31ec72684262016169db69/a9480/unity_dev_memo_2_2.png"
        srcset="/static/2f836733ac31ec72684262016169db69/f8f3a/unity_dev_memo_2_2.png 200w,
/static/2f836733ac31ec72684262016169db69/6a8a8/unity_dev_memo_2_2.png 400w,
/static/2f836733ac31ec72684262016169db69/a9480/unity_dev_memo_2_2.png 474w"
        sizes="(max-width: 474px) 100vw, 474px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<pre><code class="language-csharp">        ...
        if(plane.Raycast(ray, out distance)){
        mousePos = ray.GetPoint(distance);
    }
}
</code></pre>
<p>回到程式碼， <code>plane.Raycast</code> 中的 <code>out</code> 是另一個值得注意的地方。先看 <code>plane.Raycast</code> <a target="_blank" rel="noopener noreferrer" href="https://docs.unity3d.com/ScriptReference/Plane.Raycast.html">函數本身</a>： <code>public bool Raycast(Ray ray, out float enter);</code></p>
<p>這個函數的型別是 bool ，回傳引數 ray 是否與該 plane 相交。然而，部分函數提供額外的回傳值，取得值時必須提供一個空變數與 <code>out</code> 關鍵字一起作為引數輸入。 <code>plane.Raycast</code> 就是有提供 <code>out</code> 回傳值的函數之一，提供的是當相交發生時從 ray 起點至相交點的距離 <code>distance</code> 。因此這一段程式碼的作用是，判斷平面 plane 與 ray 是否有相交發生，如果有的話將距離儲存進 distance。現在射線起點，相交距離都知道了，就能計算出滑鼠位置便是從該射線上從起點開始距離 distance 的地方。</p>
<p><img src="/9ab1f4863920df0af27365d6b58e1390/unity_dev_memo_2_3.gif"></p>
<p>以上就是在射線上增加元素使其可視化之後的展示，紅色點是射線起點 (<code>ray.GetPoint(0)</code> )，藍色點是與平面相交點（ <code>ray.GetPoint(distance)</code> ）。可以看見起點不是攝影機本身，而是在 near clipping plane 上。</p>
<h3>Collider.Raycast</h3>
<p>以上都是純平面的情況，實際在遊戲中常常有地形非單純平面的情況，此時可以使用 <code>TerrainCollider</code> 來計算射線與地形 terrain 的相交點。</p>
<pre><code class="language-csharp">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class GetMousePos : MonoBehaviour {
    TerrainCollider terrainCollider;
    Camera camera;
    Vector3 mousePos;

    void Start () {
        camera = Camera.main;
        terrainCollider = Terrain.activeTerrain.GetComponent&#x3C;TerrainCollider>();
    }

    void Update () {
        Ray ray = camera.ScreenPointToRay(Input.mousePosition);
        RaycastHit hitData;
        if(terrainCollider.Raycast(ray, out hitData, 1000)){
            mousePos = hitData.point;
        }
    }
}
</code></pre>
<p>內容大致相同，只是這次判斷相交點的元素不是平面，而是地形碰撞體 <code>terrainCollider</code> ，而這個函數所提供的 out 相交資料也更豐富，不只有距離，而是一整個資料形態 <a target="_blank" rel="noopener noreferrer" href="https://docs.unity3d.com/ScriptReference/RaycastHit.html">RaycastHit</a> ，包含 point, distance ,collider 等，point 即為射線與 <code>terrainCollider</code> 相交點。</p>
<p><img src="/53fe811b6f10c3dc9d1b1828b8dbbded/unity_dev_memo_2_4.gif"></p>
<p>上圖就是在不規則地形使用 <code>terrainCollider.Raycast</code> 追蹤游標位置的展示，可以看見在右側遊戲畫面中游標移至山脈可見的南側時，左側的編輯器畫面也顯示游標位置的藍點直接跳過山脈北側，同時隨著地形一同起伏。</p>
<h3>Physics.Raycast</h3>
<p>以上兩種實作的前提都是射線相交的對象為特定單一物件。想要判斷射線是否相交非特定物件時，使用 <code>Physics.Raycast</code> 。這個函數會抓取引數的射線相交的第一個對象，且同樣提供 <code>out RaycastHit</code> 資料。</p>
<pre><code class="language-csharp">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class GetMousePos : MonoBehaviour {
    Camera camera;
    Vector3 mousePos;

    void Start () {
        camera = Camera.main;
    }

    void Update () {
        Ray ray = camera.ScreenPointToRay(Input.mousePosition);
        RaycastHit hitData;
        if(Physics.Raycast(ray, out hitData, 1000)){
            mousePos = hitData.point;
                        GameObject hitObj = hitData.collider.transform.gameObject;
        }
    }
}
</code></pre>
<p><code>Physics.Raycast</code> 的提供距離引數做為判斷相交的最大距離，可以依照自己需求設定。</p>
<p><img src="/decf69cf6840125171fd6f063c86e1dd/unity_dev_memo_2_5.gif"></p>
<p>上圖為使用 <code>Physics.Raycast</code> 追蹤游標互動物件的展示，使用 <code>RaycastHit.collider.transform.GameObject</code> 判斷射線的碰撞體的原物件之後就可以進行互動。</p>
<h3>LayerMask in Physics.Raycast</h3>
<p><code>Physics.Raycast</code> 還提供圖層引數過濾判斷射線相交對象。</p>
<pre><code class="language-csharp">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class HighlightRayOrigin : MonoBehaviour {
    Camera camera;
    Vector3 mousePos;
    LayerMask layerMask = 1 &#x3C;&#x3C; 8;

    void Start () {
        camera = Camera.main;
    }

    void Update () {
        Ray ray = camera.ScreenPointToRay (Input.mousePosition);
        RaycastHit hitData;
        if (Physics.Raycast (ray, out hitData, 1000, layerMask)) {
            mousePos = hitData.point;
                        GameObject hitObj = hitData.collider.transform.gameObject;
        }
    }
}
</code></pre>
<p><code>Physics.Raycast</code> 的 <code>layerMask</code> 引數就是指定圖層，只有在這個圖層中的物件才會觸發與射線相交的判斷。</p>
<p>請注意，雖然這個引數的型別是 int，但其實是二進制的 int，所以直接輸入在編輯器中顯示的圖層編號是不會正常運作的，必須以 <code>&#x3C;&#x3C;</code> 運算子將指定編號以二進制方式儲存在變數中再傳遞給 <code>Physics.Raycast</code> 函數。</p>
<p><img src="https://media.giphy.com/media/r505ukuetGAHNwCSZg/giphy.gif"></p>
<p>上圖是使用 LayerMask 過濾可互動物件的展示，只有上層物件位於可互動的圖層中，因此游標在地形或是下層物件時藍點都不會隨之移動。</p></div></main><footer><a class="footer--link_title" href="/">The work is undone.</a><div class="footer--link_container"><a class="footer--link" href="/category/gaming">GAMING</a><a class="footer--link" href="/category/programming">PROGRAMMING</a><a class="footer--link" href="/category/others">OTHERS</a></div><div class="footer--link_container">© <!-- -->2020<!-- --> <a class="footer--link" href="https://asukachikaru.com" target="_blank" rel="noopener noreferrer">asukachikaru.com</a></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/post/unity-dev-memo-(2)";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-255b885323bf9f0bff99.js"],"component---src-templates-post-content-view-js":["/component---src-templates-post-content-view-js-da53bbbc7baa758e9b08.js"],"component---src-templates-post-list-view-js":["/component---src-templates-post-list-view-js-6457fcd6814fc02cbe23.js"],"component---src-pages-404-js":["/component---src-pages-404-js-e31eb78f5a76519b5f74.js"],"component---src-pages-index-js":["/component---src-pages-index-js-27839a2630f3ca80975c.js"]};/*]]>*/</script><script src="/component---src-templates-post-content-view-js-da53bbbc7baa758e9b08.js" async=""></script><script src="/commons-680b037267ae7ccea9ab.js" async=""></script><script src="/styles-55de889ca647a3996baf.js" async=""></script><script src="/app-255b885323bf9f0bff99.js" async=""></script><script src="/webpack-runtime-93de27eba6033d0c0cfc.js" async=""></script></body></html>